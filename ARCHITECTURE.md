# 🏗️ Arquitectura del Sistema Pucara

## 📊 Diagrama de Arquitectura General

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           PUCARA MONOREPO                                   │
│                      Plataforma de Gestión de Esports                       │
└─────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────┐
│                              FRONTEND LAYER                                  │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌────────────────────────────┐      ┌────────────────────────────┐        │
│  │   ADMIN PANEL              │      │   LANDING PAGE             │        │
│  │   (React Admin)            │      │   (Astro)                  │        │
│  │   Port: 3000               │      │   Port: 4321               │        │
│  ├────────────────────────────┤      ├────────────────────────────┤        │
│  │ • CRUD Teams               │      │ • Homepage                 │        │
│  │ • CRUD Players             │      │ • Teams Showcase           │        │
│  │ • CRUD News                │      │ • Players Showcase         │        │
│  │ • CRUD Users               │      │ • News Feed                │        │
│  │ • Image Upload (Banner)    │      │ • Contact Form             │        │
│  │ • Image Upload (Photo)     │      │ • Static Content           │        │
│  │ • Authentication           │      │ • SSR/SSG                  │        │
│  └────────────┬───────────────┘      └────────────┬───────────────┘        │
│               │                                    │                         │
│               │ HTTP/REST                          │ HTTP/REST               │
│               │ (JSON/FormData)                    │ (JSON)                  │
└───────────────┼────────────────────────────────────┼─────────────────────────┘
                │                                    │
                └────────────────┬───────────────────┘
                                 │
                                 ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                              BACKEND LAYER                                   │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    ADONIS JS REST API                                │   │
│  │                      Port: 3333                                      │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │                                                                      │   │
│  │  ┌──────────────────────────────────────────────────────────────┐  │   │
│  │  │                    ROUTING LAYER                             │  │   │
│  │  │  start/routes.ts                                             │  │   │
│  │  ├──────────────────────────────────────────────────────────────┤  │   │
│  │  │  • /api/v1/teams      → TeamsController                      │  │   │
│  │  │  • /api/v1/players    → PlayersController                    │  │   │
│  │  │  • /news              → NewsController                       │  │   │
│  │  │  • /users             → UserController                       │  │   │
│  │  │  • /auth/*            → AuthController                       │  │   │
│  │  └──────────────────────────────────────────────────────────────┘  │   │
│  │                             │                                       │   │
│  │                             ▼                                       │   │
│  │  ┌──────────────────────────────────────────────────────────────┐  │   │
│  │  │                    MIDDLEWARE LAYER                          │  │   │
│  │  ├──────────────────────────────────────────────────────────────┤  │   │
│  │  │  • auth_middleware.ts     → JWT Validation                   │  │   │
│  │  │  • cors_middleware.ts     → CORS Headers                     │  │   │
│  │  │  • bodyparser             → JSON/FormData Parse              │  │   │
│  │  └──────────────────────────────────────────────────────────────┘  │   │
│  │                             │                                       │   │
│  │                             ▼                                       │   │
│  │  ┌──────────────────────────────────────────────────────────────┐  │   │
│  │  │                  CONTROLLERS LAYER                           │  │   │
│  │  ├──────────────────────────────────────────────────────────────┤  │   │
│  │  │  • TeamsController     → CRUD + Image Upload                 │  │   │
│  │  │  • PlayersController   → CRUD + Image Upload                 │  │   │
│  │  │  • NewsController      → CRUD                                │  │   │
│  │  │  • UserController      → CRUD                                │  │   │
│  │  │  • AuthController      → Login/Register/Logout               │  │   │
│  │  └──────────────────────────────────────────────────────────────┘  │   │
│  │                             │                                       │   │
│  │                             ▼                                       │   │
│  │  ┌──────────────────────────────────────────────────────────────┐  │   │
│  │  │                    SERVICES LAYER                            │  │   │
│  │  ├──────────────────────────────────────────────────────────────┤  │   │
│  │  │  ImageStorageService (Factory Pattern)                       │  │   │
│  │  │      │                                                        │  │   │
│  │  │      ├─→ LocalStorageProvider     (public/uploads/)          │  │   │
│  │  │      ├─→ CloudinaryProvider       (Cloudinary CDN)           │  │   │
│  │  │      └─→ S3Provider               (AWS S3)                   │  │   │
│  │  │                                                               │  │   │
│  │  │  • uploadImage(file, folder)                                 │  │   │
│  │  │  • deleteImage(imageUrl, publicId?)                          │  │   │
│  │  │  • getProviderName()                                         │  │   │
│  │  └──────────────────────────────────────────────────────────────┘  │   │
│  │                             │                                       │   │
│  │                             ▼                                       │   │
│  │  ┌──────────────────────────────────────────────────────────────┐  │   │
│  │  │                    MODELS LAYER (ORM)                        │  │   │
│  │  ├──────────────────────────────────────────────────────────────┤  │   │
│  │  │  • Team Model          → teams table                         │  │   │
│  │  │  • Player Model        → players table                       │  │   │
│  │  │  • News Model          → news table                          │  │   │
│  │  │  • User Model          → users table                         │  │   │
│  │  └──────────────────────────────────────────────────────────────┘  │   │
│  │                             │                                       │   │
│  └─────────────────────────────┼───────────────────────────────────────┘   │
│                                │                                           │
└────────────────────────────────┼───────────────────────────────────────────┘
                                 │
                                 ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                          PERSISTENCE LAYER                                   │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌────────────────────────────┐      ┌────────────────────────────┐        │
│  │   DATABASE                 │      │   FILE STORAGE             │        │
│  │   (SQLite)                 │      │   (Local/Cloudinary/S3)    │        │
│  ├────────────────────────────┤      ├────────────────────────────┤        │
│  │ Tables:                    │      │ Local:                     │        │
│  │ • users                    │      │   public/uploads/teams/    │        │
│  │ • news                     │      │   public/uploads/players/  │        │
│  │ • teams                    │      │                            │        │
│  │ • players                  │      │ Cloudinary:                │        │
│  │ • player_teams (future)    │      │   CDN URLs                 │        │
│  │                            │      │                            │        │
│  │ Location:                  │      │ S3:                        │        │
│  │ database/pucara.sqlite     │      │   S3 Bucket URLs           │        │
│  └────────────────────────────┘      └────────────────────────────┘        │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```
