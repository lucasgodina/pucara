---
import '../assets/styles/global.css';
import { ViewTransitions } from 'astro:transitions';

import Navbar from '../components/navbar.astro';
import Footer from '../components/footer.astro';
import GamingRouter from '../components/GamingRouter.astro';

export interface Props {
	title: string;
	description?: string;
	keywords?: string;
	ogImage?: string;
	preloadImages?: string[];
}

const { 
	title, 
	description = "Pucará Gaming: la organización de esports líder en Argentina. Equipos profesionales de Dota 2, Street Fighter, Tekken y más. Sumate a nuestra comunidad gaming.",
	keywords = "pucara gaming, esports argentina, dota 2, street fighter, gaming, esports, tournaments, argentina gaming, competitive gaming, Pucara, pucara, PUCARA",
	ogImage = "/herobanner.png",
	preloadImages = []
} = Astro.props;

// Preload images críticas basado en la URL actual
const currentPath = Astro.url.pathname;
let criticalImages: string[] = [...preloadImages];

// Agregar imágenes críticas automáticamente según la página
if (currentPath === '/home' || currentPath === '/') {
	criticalImages.push('/pucarahero.webp', '/logopucara.png');
} else if (currentPath === '/about') {
	criticalImages.push('/vision.webp', '/achievements.webp');
} else if (currentPath.includes('/teams')) {
	criticalImages.push('/D2banner.png', '/SFbanner.png', '/FC25banner.png');
}

// Eliminar duplicados
criticalImages = [...new Set(criticalImages)];
---
<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content={description} />
		<meta name="keywords" content={keywords} />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="author" content="Pucará Gaming" />
		<meta name="robots" content="index, follow" />
		
		<!-- Favicon -->
		<link rel="icon" type="image/x-icon" href="/favicon.ico" />
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
		<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
		<link rel="manifest" href="/site.webmanifest" />
		
		<!-- Preload Critical Images -->
		{criticalImages.map((imageUrl) => (
			<link rel="preload" as="image" href={imageUrl} />
		))}
		
		<meta name="generator" content={Astro.generator} />
		<ViewTransitions />
		<title>{title}</title>

		<!-- Google reCAPTCHA v2 - Carga explícita con callback -->
		<script is:inline src="https://www.google.com/recaptcha/api.js?onload=onRecaptchaLoad&render=explicit" async defer></script>
	</head>
	<body>
		<Navbar />

		<!-- Espaciador global para compensar el navbar fijo -->
		<div class="navbar-global-spacer"></div>

		<main>
			<slot />
		</main>

		<Footer />

		<!-- Gaming Router Enhancements -->
		<GamingRouter />

		<script>
			// Script optimizado para detectar scroll y cambiar la apariencia del navbar
			const navbar = document.querySelector('nav');
			
			if (navbar) {
				let ticking = false;
				
				const updateNavbar = () => {
					if (window.scrollY > 50) {
						navbar.classList.add('scrolled');
					} else {
						navbar.classList.remove('scrolled');
					}
					ticking = false;
				};

				const onScroll = () => {
					if (!ticking) {
						requestAnimationFrame(updateNavbar);
						ticking = true;
					}
				};

				window.addEventListener('scroll', onScroll, { passive: true });
			}
		</script>
	</body>
</html>
